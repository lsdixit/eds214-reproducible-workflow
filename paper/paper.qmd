---
title: "Reproducing Figure 3 from Shaefer et al 2000."
format: html
editor_options: 
  chunk_output_type: console
---

## Background
This analysis is based on the paper by Shaefer et. al. 2000 "Effects of hurricane disturbance on stream water concentrations and fluxes in eight tropical forest watersheds of the Luquillo Experimental Forest, Puerto Rico". In this study they assessed effects of tropical hurricanes on stream water chemistry in various watersheds of the Luquillo Experimental Forest (LEF) in Puerto Rico. They specifically looked at the effects after the 1989 Hurricane Hugo.

In this analysis, we are creating a workflow to recreate Figure 3. This plot shows the ion concentrations for 5 ions (NH4-N, Ca, Mg, NO3-N, and K) over time, separated by the four Bisley, Puerto Rico streams. 

## Data
These data and associated metadata can be found [on Environmental Data Initiative](https://doi.org/10.6073/PASTA/F31349BEBDC304F758718F4798D25458). These data run from 1986-2020, with weekly water sampling for various ion concentrations. This analysis consists of only four stream sites: MPR, Q1, Q2, and Q3. These are all from the Bisley, Puerto Rico watershed area. Chemical concentrations are recorded as mg/L or ug/L as appropriate. Values below detection limits are recorded as 1/2 the detection limit.

## Methods

Packages used were loaded from the [01_environment-installation.R](https://github.com/lsdixit/eds214-reproducible-workflow/blob/main/01_environment-installation.R). All four data frames were read in, cleaned, and the moving average function applied to each individually in the [02_data-cleaning.R](https://github.com/lsdixit/eds214-reproducible-workflow/blob/main/02_data-cleaning.R) file. 

Source the function to calculate moving avergae from [moving_average.R](https://github.com/lsdixit/eds214-reproducible-workflow/blob/main/R/moving_average.R)

## Results
```{r}
#| echo: false
#| message: FALSE
#| warning: false
# read in packages
library(here)
library(tidyverse)
# source the plot function
source(here("R", "plot.R"))
# read in clean data
full_data <- read_csv(here("output", "full_data.csv"))
```

Data are found in the [Output folder.](https://github.com/lsdixit/eds214-reproducible-workflow/tree/main/output) Data are limited for the MPR site and for the NH4 ion prior to 1989. 

```{r}
#| warning: false
# apply the plot function with the data and parameters
hurricane_ions_plot(full_data, sample_date, concentration)
```

```{r}
#| echo: false
#| message: FALSE
# saves the final plot into the figures folder
ggsave(here("figs", "figure-3.jpg"))
```

This plot shows continuous date on the x axis, and 5 different ion concentrations on the y axis. Each line represents one of the 4 sites measured. The vertical dashed line indicated the dates of Hurricane Hugo in 1989.

We can see that for most ions and sites, concentrations increased following Hurricane Hugo and stayed increased for several months, if not longer.  